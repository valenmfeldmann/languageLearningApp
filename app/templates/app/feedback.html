{% extends "base.html" %}
{% block content %}
<style>
  .feedback-container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
  .feedback-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
  .tab-container { display: flex; gap: 20px; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); }
  .tab { padding: 10px 5px; cursor: pointer; color: rgba(255,255,255,0.6); text-decoration: none; }
  .tab.active { color: #fff; border-bottom: 2px solid var(--link); }
  
  .post-card { 
    background: rgba(255, 255, 255, 0.05); 
    border: 1px solid rgba(255,255,255,0.1); 
    border-radius: 12px; 
    padding: 20px; 
    margin-bottom: 16px; 
    display: flex; 
    gap: 20px;
  }
  .vote-column { display: flex; flex-direction: column; align-items: center; min-width: 40px; }
  .vote-btn { 
    background: none; border: none; color: rgba(255,255,255,0.4); 
    font-size: 24px; cursor: pointer; transition: color 0.2s; 
  }
  .vote-btn:hover { color: var(--link); }
  .score { font-weight: bold; margin: 5px 0; font-size: 18px; }
  
  .post-content h3 { margin: 0 0 8px 0; color: #fff; }
  .post-meta { font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 10px; }
  
  .suggestion-box { 
    background: rgba(0,0,0,0.3); border-radius: 12px; padding: 20px; margin-bottom: 40px; 
    border: 1px dashed rgba(255,255,255,0.2);
  }
  .input-group { margin-bottom: 15px; }
  .input-group label { display: block; margin-bottom: 5px; font-size: 14px; }
  .feedback-input { 
    width: 100%; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); 
    border-radius: 8px; padding: 12px; color: #fff; outline: none;
  }
</style>

<div class="feedback-container">
  <div class="feedback-header">
    <h1>Community Feedback</h1>
  </div>

  <div class="suggestion-box">
    <h3 style="margin-top:0">Have an idea for {{ current_user.username }}?</h3>
    <form method="POST" action="{{ url_for('appui.feedback_page') }}">
      <div class="input-group">
        <input type="text" name="title" class="feedback-input" placeholder="Short title (e.g. 'Add more Italian verbs')" required>
      </div>
      <div class="input-group">
        <textarea name="content" class="feedback-input" rows="3" placeholder="Explain your idea..." required></textarea>
      </div>
      <button type="submit" class="btn primary">Submit Suggestion</button>
    </form>
  </div>

  <div class="tab-container">
    <a href="{{ url_for('appui.feedback_page') }}" class="tab {% if not resolved_view %}active{% endif %}">Active Suggestions</a>
    <a href="{{ url_for('appui.feedback_page', view='resolved') }}" class="tab {% if resolved_view %}active{% endif %}">Resolved</a>
  </div>

  {% for post, score in posts %}
    <div class="post-card">
      <div class="vote-column">
        <form method="POST" action="{{ url_for('appui.feedback_vote', post_id=post.id, val=1) }}">
          <button type="submit" class="vote-btn"
                  style="{% if user_votes.get(post.id) == 1 %}color: var(--link); text-shadow: 0 0 10px var(--link);{% endif %}">
            ▲
          </button>
        </form>

        <div class="score">{{ score or 0 }}</div>

        <form method="POST" action="{{ url_for('appui.feedback_vote', post_id=post.id, val=-1) }}">
          <button type="submit" class="vote-btn"
                  style="{% if user_votes.get(post.id) == -1 %}color: var(--danger); text-shadow: 0 0 10px var(--danger);{% endif %}">
            ▼
          </button>
        </form>
      </div>


      <div class="post-content">
        <h3>{{ post.title }}</h3>
        <p class="muted">{{ post.content }}</p>
        <div class="post-meta">
          Submitted by <b>{{ post.author.username }}</b> • {{ post.created_at.strftime('%b %d, %Y') }}
          {% if post.is_resolved %}
            <span style="color: #4CAF50; margin-left: 10px;">✔ Resolved</span>
          {% endif %}
        </div>
      </div>
    </div>
  {% else %}
    <p class="muted" style="text-align: center; margin-top: 40px;">No suggestions yet. Be the first!</p>
  {% endfor %}
</div>
{% endblock %}