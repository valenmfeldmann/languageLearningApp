{% extends "base.html" %}
{% block content %}
  <h1>New lesson</h1>

  <form method="post" action="{{ url_for('author.lesson_new_post') }}">

    <label for="subject_code">Subject</label>
    <select id="subject_code" name="subject_code">
      <option value="">(none)</option>
      {% for s in subjects %}
        <option value="{{ s.code }}">{{ s.name }}</option>
      {% endfor %}
    </select>


    <div style="margin-top:12px;">
      <label style="font-weight: 700;">Title</label><br>
      <input type="text" id="title-input" name="title" required
             placeholder="e.g. Spanish Basics 1"
             style="width: 100%; font-size: 1.1rem; padding: 12px;">
    </div>

    <div style="margin-top:12px; opacity: 0.75;">
      <label style="font-size: 12px; color: var(--muted);">URL Slug (autogenerated)</label><br>
      <input type="text" id="code-input" name="code" required
             placeholder="spanish-basics-01"
             style="width: 100%; border-style: dashed; font-size: 13px; font-family: monospace; background: rgba(0,0,0,0.1);">
    </div>




    <div style="margin-top:12px;">
      <label>Description</label><br>
      <textarea name="description" rows="3"></textarea>
    </div>

<!--    <div style="margin-top:12px;">-->
<!--      <label>Language code</label><br>-->
<!--      <input name="language_code" placeholder="es">-->
<!--    </div>-->

    <div style="margin-top:12px;">
      <button type="submit">Create</button>
    </div>
  </form>


<script>
  document.addEventListener('DOMContentLoaded', () => {
    const titleInput = document.getElementById('title-input');
    const codeInput = document.getElementById('code-input');

    if (!titleInput || !codeInput) return; // Safety check

    let manualEdit = false;
    const suffix = Math.random().toString(16).substring(2, 6);

    codeInput.addEventListener('input', () => { manualEdit = true; });

    titleInput.addEventListener('input', () => {
      if (manualEdit) return;

      const baseSlug = titleInput.value
        .toLowerCase()
        .trim()
        .replace(/[\s_]+/g, '-')
        .replace(/[^\w\-]+/g, '')
        .replace(/\-\-+/g, '-')
        .replace(/^-+/, '')
        .replace(/-+$/, '');

      // Only append suffix if there is actual text in the slug
      codeInput.value = baseSlug ? `${baseSlug}-${suffix}` : '';
    });
  });
</script>


{% endblock %}
