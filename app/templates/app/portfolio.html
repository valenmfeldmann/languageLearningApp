{% extends "base.html" %}
{% block title %}Portfolio | GamifyLearning{% endblock %}

{% block content %}
<style>
  /* 1. Global Container & Header */
  .portfolio-wrapper {
    max-width: 1100px;
    margin: 0 auto;
    padding: 24px;
  }

  .portfolio-header {
    margin-bottom: 32px;
  }

  .portfolio-header h1 {
    margin: 0;
    font-weight: 800;
    letter-spacing: -1.5px;
    font-size: 2.5rem;
  }

  /* 2. Stat Tiles Grid */
  .metric-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 16px;
    margin-bottom: 32px;
  }

  .stat-tile {
    background: var(--card);
    border: 1px solid rgba(255, 255, 255, 0.06);
    padding: 24px;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    transition: transform 0.2s ease, border-color 0.2s ease;
  }

  .stat-tile:hover {
    transform: translateY(-4px);
    border-color: rgba(168, 199, 255, 0.2);
  }

  .stat-label {
    font-size: 0.7rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1.2px;
    font-weight: 700;
    margin-bottom: 8px;
  }

  .stat-value {
    font-size: 1.8rem;
    font-weight: 800;
    color: var(--text);
    display: flex;
    align-items: baseline;
    gap: 8px;
  }

  .stat-value span {
    font-size: 0.9rem;
    font-weight: 400;
    color: var(--muted);
  }

  /* 3. Holdings Table Styling */
  .holdings-container {
    background: var(--card);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 30px rgba(0,0,0,0.3);
  }

  .holdings-header {
    padding: 20px 24px;
    background: rgba(168, 199, 255, 0.03);
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .portfolio-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
  }

  .portfolio-table th {
    text-align: left;
    padding: 16px 24px;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--muted);
    background: rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }

  .portfolio-table td {
    padding: 18px 24px;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    transition: background 0.2s;
  }

  .portfolio-table tr:hover td {
    background: rgba(168, 199, 255, 0.02);
  }

  .mono {
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
    font-variant-numeric: tabular-nums;
  }

  .curriculum-link {
    font-weight: 700;
    color: var(--text);
    text-decoration: none;
    transition: color 0.2s;
  }

  .curriculum-link:hover {
    color: var(--link);
  }

  .note-box {
    margin-top: 24px;
    padding: 16px 20px;
    background: rgba(255, 255, 255, 0.02);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.05);
    font-size: 0.75rem;
    line-height: 1.5;
  }
</style>

<div class="portfolio-wrapper">

  <div class="portfolio-header">
    <h1>Portfolio</h1>
    <p class="muted">A real-time overview of your curriculum equity and liquid assets.</p>
  </div>

  <div class="metric-grid">
    <div class="stat-tile">
      <div class="stat-label">Total Market Value</div>
      <div class="stat-value">{{ grand_market_an }} <span>AN</span></div>
    </div>

    <div class="stat-tile" style="border-color: rgba(168, 199, 255, 0.2);">
      <div class="stat-label">Liquidation Value</div>
      <div class="stat-value" style="color: var(--link);">{{ grand_liquidation_an }} <span>AN</span></div>
    </div>

    <div class="stat-tile">
      <div class="stat-label">Available Cash</div>
      <div class="stat-value">{{ cash_an }} <span>AN</span></div>
    </div>
  </div>

  <div class="holdings-container">
    <div class="holdings-header">
      <div style="font-weight: 700; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
        <span style="font-size: 1.2rem;">üèõÔ∏è</span> Asset Holdings
      </div>
      <div class="muted" style="font-size: 0.75rem; font-weight: 600;">{{ rows|length }} Active Positions</div>
    </div>

    {% if rows|length == 0 %}
      <div style="padding: 80px 24px; text-align: center;">
        <div style="font-size: 3rem; margin-bottom: 16px; opacity: 0.2;">üìä</div>
        <h3 class="muted">No holdings found</h3>
        <p class="muted" style="font-size: 0.9rem; max-width: 400px; margin: 0 auto;">
          Once you acquire curriculum shares through the market, your position details and values will appear here.
        </p>
      </div>
    {% else %}
      <div style="overflow-x: auto;">
        <table class="portfolio-table">
          <thead>
            <tr>
              <th>Curriculum</th>
              <th>Shares</th>
              <th>Last Price</th>
              <th>Market Value</th>
              <th style="text-align: right;">Liquidation</th>
            </tr>
          </thead>
          <tbody>
            {% for r in rows %}
            <tr>
              <td>
                <div style="margin-bottom: 2px;">
                  <span class="curriculum-link">{{ r.title }}</span>
                </div>
                <div class="muted" style="font-size: 0.7rem; font-family: monospace; opacity: 0.6;">
                  {{ r.curriculum_id[:16] }}...
                </div>
              </td>
              <td class="mono" style="font-weight: 700;">{{ r.shares }}</td>
              <td class="mono">{{ r.last_price_an }} <small class="muted">AN</small></td>
              <td class="mono" style="color: var(--text); font-weight: 700;">{{ r.market_value_an }} <small class="muted">AN</small></td>
              <td class="mono" style="text-align: right; color: var(--link); font-weight: 800;">
                {{ r.liquidation_value_an }} <small style="color: var(--muted); font-weight: 400;">AN</small>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  </div>

  <div class="note-box muted">
    <div style="margin-bottom: 4px; color: var(--text); font-weight: 700; font-size: 0.8rem;">
      Understanding your Portfolio:
    </div>
    <ul style="margin: 0; padding-left: 18px;">
      <li><strong>Market Value:</strong> Calculated based on the most recent successful trade price in the order book.</li>
      <li><strong>Liquidation Value:</strong> The estimated amount of AN you would receive if you sold all shares immediately into existing "Bid" orders. This accounts for market depth and assumes no new buyers enter the market.</li>
    </ul>
  </div>
</div>
{% endblock %}